<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#sec-1">1. Usage</a>
<ul>
<li><a href="#sec-1-1">1.1. Installation</a></li>
<li><a href="#sec-1-2">1.2. Keyboard shortcuts</a></li>
<li><a href="#sec-1-3">1.3. Contributions</a></li>
</ul>
</li>
<li><a href="#sec-2">2. Code</a>
<ul>
<li><a href="#sec-2-1">2.1. Load Path</a></li>
<li><a href="#sec-2-2">2.2. El-Get</a></li>
<li><a href="#sec-2-3">2.3. Packages</a></li>
<li><a href="#sec-2-4">2.4. Key Bindings</a></li>
<li><a href="#sec-2-5">2.5. general options</a>
<ul>
<li><a href="#sec-2-5-1">2.5.1. system specific settings</a></li>
</ul>
</li>
<li><a href="#sec-2-6">2.6. theme, faces, frame</a></li>
<li><a href="#sec-2-7">2.7. custom functions</a></li>
<li><a href="#sec-2-8">2.8. advices</a></li>
<li><a href="#sec-2-9">2.9. modes</a>
<ul>
<li><a href="#sec-2-9-1">2.9.1. auctex-mode</a></li>
<li><a href="#sec-2-9-2">2.9.2. auto-complete</a></li>
<li><a href="#sec-2-9-3">2.9.3. auto-save-buffers-enhanced</a></li>
<li><a href="#sec-2-9-4">2.9.4. back-button</a></li>
<li><a href="#sec-2-9-5">2.9.5. conf-mode</a></li>
<li><a href="#sec-2-9-6">2.9.6. deft</a></li>
<li><a href="#sec-2-9-7">2.9.7. dired+</a></li>
<li><a href="#sec-2-9-8">2.9.8. eval-sexp-fu</a></li>
<li><a href="#sec-2-9-9">2.9.9. ecb</a></li>
<li><a href="#sec-2-9-10">2.9.10. erc mode</a></li>
<li><a href="#sec-2-9-11">2.9.11. fic-ext-mode</a></li>
<li><a href="#sec-2-9-12">2.9.12. flex-isearch</a></li>
<li><a href="#sec-2-9-13">2.9.13. flycheck-mode</a></li>
<li><a href="#sec-2-9-14">2.9.14. fringe</a></li>
<li><a href="#sec-2-9-15">2.9.15. git-gutter-fringe+</a></li>
<li><a href="#sec-2-9-16">2.9.16. google-this</a></li>
<li><a href="#sec-2-9-17">2.9.17. haskell-mode</a></li>
<li><a href="#sec-2-9-18">2.9.18. helm</a></li>
<li><a href="#sec-2-9-19">2.9.19. highlight-symbol</a></li>
<li><a href="#sec-2-9-20">2.9.20. html-mode</a></li>
<li><a href="#sec-2-9-21">2.9.21. ido-mode</a></li>
<li><a href="#sec-2-9-22">2.9.22. iedit</a></li>
<li><a href="#sec-2-9-23">2.9.23. isearch+</a></li>
<li><a href="#sec-2-9-24">2.9.24. jinja2-mode for twig</a></li>
<li><a href="#sec-2-9-25">2.9.25. js2-mode</a></li>
<li><a href="#sec-2-9-26">2.9.26. json-mode</a></li>
<li><a href="#sec-2-9-27">2.9.27. magit</a></li>
<li><a href="#sec-2-9-28">2.9.28. markdown</a></li>
<li><a href="#sec-2-9-29">2.9.29. melpa-upstream-visit</a></li>
<li><a href="#sec-2-9-30">2.9.30. move-text</a></li>
<li><a href="#sec-2-9-31">2.9.31. mu4e</a></li>
<li><a href="#sec-2-9-32">2.9.32. mutt, load mail-mode</a></li>
<li><a href="#sec-2-9-33">2.9.33. nrepl</a></li>
<li><a href="#sec-2-9-34">2.9.34. nrepl-eval-sexp-fu</a></li>
<li><a href="#sec-2-9-35">2.9.35. org-mode</a></li>
<li><a href="#sec-2-9-36">2.9.36. org-reveal</a></li>
<li><a href="#sec-2-9-37">2.9.37. php-mode</a></li>
<li><a href="#sec-2-9-38">2.9.38. prog-mode</a></li>
<li><a href="#sec-2-9-39">2.9.39. projectile</a></li>
<li><a href="#sec-2-9-40">2.9.40. rainbow-mode</a></li>
<li><a href="#sec-2-9-41">2.9.41. rcirc</a></li>
<li><a href="#sec-2-9-42">2.9.42. robe</a></li>
<li><a href="#sec-2-9-43">2.9.43. saveplace</a></li>
<li><a href="#sec-2-9-44">2.9.44. slime-js</a></li>
<li><a href="#sec-2-9-45">2.9.45. smartparens</a></li>
<li><a href="#sec-2-9-46">2.9.46. sgml</a></li>
<li><a href="#sec-2-9-47">2.9.47. slime</a></li>
<li><a href="#sec-2-9-48">2.9.48. sql-completion</a></li>
<li><a href="#sec-2-9-49">2.9.49. term-mode</a></li>
<li><a href="#sec-2-9-50">2.9.50. tempo</a></li>
<li><a href="#sec-2-9-51">2.9.51. uniqify</a></li>
<li><a href="#sec-2-9-52">2.9.52. yaml-mode</a></li>
<li><a href="#sec-2-9-53">2.9.53. yasnippets</a></li>
<li><a href="#sec-2-9-54">2.9.54. w3m, optional</a></li>
<li><a href="#sec-2-9-55">2.9.55. yaml-mode</a></li>
</ul>
</li>
<li><a href="#sec-2-10">2.10. end</a>
<ul>
<li><a href="#sec-2-10-1">2.10.1. my-keys-minor-mode</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>

# Usage

**Warning - currently the setup might be unstable. I'm working on integrating the configuration with Org mode**

**steckemacs** is an Emacs configuration that integrates around 60 modes (packages). Stock Emacs is not very useful and lacks many convenient commands. Over the years I've discovered many good extensions and added them to this setup. The goal is to keep everything in one file `steckemacs.org` (plus `.emacs` for the initialization) and not as many others to split it over lots of files and directories. Packages are retrieved from the Emacs package repositories on the internet on the first startup.

If you want to know more about how that works, read my blog entry here:  <http://steckerhalter.co.vu/blog/201304/steckemacs>

**To use this setup please use Emacs 24 or later. Older versions do not work properly.**

## Installation

Change to a directory of your choice and clone **steckemacs**:

    cd <my directory>
    git clone https://github.com/steckerhalter/steckemacs.git

And symlink `.emacs` into your home directory:

    cd ~
    ln -s <path to the directory from above>/.emacs

That's it. Then you can run emacs and it should pick up the config, install all the packages and make you happy ;)

## Keyboard shortcuts

By using the `key-chord` mode we can avoid having to type C- or M- all the time. It allows for using keys pressed simultaneously and I'm using it quite often.

When I write `fg` as a key combo it means you would have to press `f` and `g` at the same time.

I only describe my custom key combinations currently. To learn the standard Emacs commands, go through the Tutorial `C-h t`, use `C-S-h` or `M-x` to see/filter the available commands/shortcuts.

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="left" />

<col  class="left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="left">Combo</th>
<th scope="col" class="left">Desciption</th>
</tr>
</thead>

<tbody>
<tr>
<td class="left">C-c X</td>
<td class="left">Kill emacs (including the daemon if it is running)</td>
</tr>


<tr>
<td class="left">C-c s</td>
<td class="left">Open emacs shell</td>
</tr>


<tr>
<td class="left">C-S-l</td>
<td class="left">List available packages</td>
</tr>


<tr>
<td class="left">C-c d</td>
<td class="left">Change dictionary</td>
</tr>


<tr>
<td class="left">C-h C-f</td>
<td class="left">Go to the definition of the function under cursor</td>
</tr>


<tr>
<td class="left">C-h C-v</td>
<td class="left">Go to the definition of the variable under cursor</td>
</tr>


<tr>
<td class="left">C-c C-w</td>
<td class="left">Browse URL under cursor</td>
</tr>


<tr>
<td class="left">cd</td>
<td class="left">Open dired in current file location</td>
</tr>


<tr>
<td class="left">sb</td>
<td class="left">Open the speedbar</td>
</tr>


<tr>
<td class="left">cg</td>
<td class="left">Customize group</td>
</tr>


<tr>
<td class="left">C-c m</td>
<td class="left">Toggle the menu bar</td>
</tr>


<tr>
<td class="left">C--</td>
<td class="left">Decrease the font size</td>
</tr>


<tr>
<td class="left">C-=</td>
<td class="left">Increase the font size</td>
</tr>


<tr>
<td class="left">ln</td>
<td class="left">Show/hide the line numbers</td>
</tr>


<tr>
<td class="left">C-c r</td>
<td class="left">Revert a buffer to the saved state</td>
</tr>


<tr>
<td class="left">C-x C-b</td>
<td class="left">use ido to switch buffers</td>
</tr>


<tr>
<td class="left"><f6></td>
<td class="left">Kill current buffer</td>
</tr>


<tr>
<td class="left"><f8></td>
<td class="left">Switch to "other" buffer</td>
</tr>


<tr>
<td class="left">jn</td>
<td class="left">Switch to "other" buffer</td>
</tr>


<tr>
<td class="left">fv</td>
<td class="left">Kill current buffer</td>
</tr>


<tr>
<td class="left"><M-up></td>
<td class="left">Move the current buffer window up</td>
</tr>


<tr>
<td class="left"><M-down></td>
<td class="left">Move the current buffer window down</td>
</tr>


<tr>
<td class="left"><M-left></td>
<td class="left">Move the current buffer window left</td>
</tr>


<tr>
<td class="left"><M-right></td>
<td class="left">Move the current buffer window right</td>
</tr>


<tr>
<td class="left">eb</td>
<td class="left">Evaluate the current buffer</td>
</tr>


<tr>
<td class="left">sv</td>
<td class="left">Save the current buffer</td>
</tr>


<tr>
<td class="left">sc</td>
<td class="left">Switch to scratch buffer</td>
</tr>


<tr>
<td class="left">C-0</td>
<td class="left">Select previous window</td>
</tr>


<tr>
<td class="left">C-9</td>
<td class="left">Select next window</td>
</tr>


<tr>
<td class="left"><f2></td>
<td class="left">Split window vertically</td>
</tr>


<tr>
<td class="left"><f3></td>
<td class="left">Split window horizontally</td>
</tr>


<tr>
<td class="left"><f4></td>
<td class="left">Delete current window (not the buffer)</td>
</tr>


<tr>
<td class="left"><f5></td>
<td class="left">Only keep the current window and delete all others</td>
</tr>


<tr>
<td class="left"><C-left></td>
<td class="left">Shrink window</td>
</tr>


<tr>
<td class="left"><C-right></td>
<td class="left">Enlarge window</td>
</tr>


<tr>
<td class="left"><C-up></td>
<td class="left">Shrink window horizontally</td>
</tr>


<tr>
<td class="left"><C-down></td>
<td class="left">Enlarge window horizontally</td>
</tr>


<tr>
<td class="left">i9</td>
<td class="left">Toggle electric indent mode</td>
</tr>


<tr>
<td class="left">M-W</td>
<td class="left">delete region (but don't put it into kill ring)</td>
</tr>


<tr>
<td class="left">C-c j</td>
<td class="left">Join lines together</td>
</tr>


<tr>
<td class="left">C-c w</td>
<td class="left">cleanup whitespaces</td>
</tr>


<tr>
<td class="left">C-c i</td>
<td class="left">indent the whole the buffer</td>
</tr>


<tr>
<td class="left">ac</td>
<td class="left">Align nearby elements</td>
</tr>


<tr>
<td class="left">C-c q</td>
<td class="left">toggles word wrap</td>
</tr>


<tr>
<td class="left">vg</td>
<td class="left">VC git grep</td>
</tr>


<tr>
<td class="left">fg</td>
<td class="left">Grep find</td>
</tr>


<tr>
<td class="left">C-c o</td>
<td class="left">list matching regexp</td>
</tr>


<tr>
<td class="left">M-6</td>
<td class="left">Find tag in a new window</td>
</tr>


<tr>
<td class="left">C-c n</td>
<td class="left">Show file name + path, save to clipboard</td>
</tr>


<tr>
<td class="left"><f9></td>
<td class="left">Split window and show/hide last buffer</td>
</tr>


<tr>
<td class="left"><f7></td>
<td class="left">Toggle arrangement of two windows horizontally/vertically</td>
</tr>


<tr>
<td class="left">C-c t</td>
<td class="left">Open terminal in current directory</td>
</tr>


<tr>
<td class="left">C-c T</td>
<td class="left">Open terminal in current project root</td>
</tr>


<tr>
<td class="left">C-6</td>
<td class="left">Use autojump to navigate to a directory (with IDO)</td>
</tr>


<tr>
<td class="left">ag</td>
<td class="left">Use the ag cli tool to grep project</td>
</tr>


<tr>
<td class="left">C-3</td>
<td class="left">Go backward in movement history</td>
</tr>


<tr>
<td class="left">C-4</td>
<td class="left">Go forward in movement history</td>
</tr>


<tr>
<td class="left">C-c c</td>
<td class="left">Open deft (quick notes tool)</td>
</tr>


<tr>
<td class="left">C-c e</td>
<td class="left">Connect with  ERC</td>
</tr>


<tr>
<td class="left">C-8</td>
<td class="left">Select symbol under cursor, repeat to expand</td>
</tr>


<tr>
<td class="left">M-8</td>
<td class="left">Contract the current selection</td>
</tr>


<tr>
<td class="left">fc</td>
<td class="left">Toggle flycheck mode</td>
</tr>


<tr>
<td class="left">C-c f</td>
<td class="left">Toggle flyspell mode</td>
</tr>


<tr>
<td class="left">gt</td>
<td class="left">Google "this"</td>
</tr>


<tr>
<td class="left">gs</td>
<td class="left">Google search</td>
</tr>


<tr>
<td class="left">M-x</td>
<td class="left">Helm M-x</td>
</tr>


<tr>
<td class="left"><C-f7></td>
<td class="left">Helm mini</td>
</tr>


<tr>
<td class="left"><C-S-iso-lefttab></td>
<td class="left">Helm for files</td>
</tr>


<tr>
<td class="left">C-x f</td>
<td class="left">Helm find files</td>
</tr>


<tr>
<td class="left">M-5</td>
<td class="left">Helm select etags</td>
</tr>


<tr>
<td class="left">M-7</td>
<td class="left">Helm show the kill ring</td>
</tr>


<tr>
<td class="left">C-5</td>
<td class="left">Helm show all mark rings</td>
</tr>


<tr>
<td class="left">M-9</td>
<td class="left">Helm search for occurences in open buffers</td>
</tr>


<tr>
<td class="left">M--</td>
<td class="left">Helm resume</td>
</tr>


<tr>
<td class="left">C-S-h</td>
<td class="left">Helm describe key Bindings</td>
</tr>


<tr>
<td class="left">C-c h</td>
<td class="left">Helm navigate project files</td>
</tr>


<tr>
<td class="left">fw</td>
<td class="left">Helm find files</td>
</tr>


<tr>
<td class="left">hg</td>
<td class="left">Helm grep</td>
</tr>


<tr>
<td class="left">lo</td>
<td class="left">Helm locate</td>
</tr>


<tr>
<td class="left">34</td>
<td class="left">Helm imenu</td>
</tr>


<tr>
<td class="left">M-0</td>
<td class="left">Helm find files with Git</td>
</tr>


<tr>
<td class="left"><C-f8></td>
<td class="left">Show/hide comments</td>
</tr>


<tr>
<td class="left">M-2</td>
<td class="left">Show all symbols like the one cursor is located at</td>
</tr>


<tr>
<td class="left">M-3</td>
<td class="left">Previous symbol like the one the cursor is on</td>
</tr>


<tr>
<td class="left">M-4</td>
<td class="left">Next symbol like the one the cursor is on</td>
</tr>


<tr>
<td class="left">C-c g</td>
<td class="left">Magit status - manual: <http://magit.github.io/magit/></td>
</tr>


<tr>
<td class="left">C-c l</td>
<td class="left">Magit log</td>
</tr>


<tr>
<td class="left">bm</td>
<td class="left">Magit blame mode</td>
</tr>


<tr>
<td class="left"><C-f10></td>
<td class="left">Move line or region up</td>
</tr>


<tr>
<td class="left"><C-f9></td>
<td class="left">Move line or region down</td>
</tr>


<tr>
<td class="left">nm</td>
<td class="left">Open mu4e</td>
</tr>


<tr>
<td class="left">C-S-c C-S-c</td>
<td class="left">Edit region with multiple cursors</td>
</tr>


<tr>
<td class="left">C-<</td>
<td class="left">Multiple cursors up</td>
</tr>


<tr>
<td class="left">C-></td>
<td class="left">Multiple cursors down</td>
</tr>


<tr>
<td class="left">C-\*</td>
<td class="left">Mark all like "this" with multiple cursors</td>
</tr>


<tr>
<td class="left">C-c A</td>
<td class="left">Org mode capture (todo)</td>
</tr>


<tr>
<td class="left">C-c a</td>
<td class="left">Open Org mode agenda</td>
</tr>


<tr>
<td class="left">bv</td>
<td class="left">PHP: var<sub>dump</sub> die template</td>
</tr>


<tr>
<td class="left">dv</td>
<td class="left">PHP: var<sub>dump</sub> template</td>
</tr>


<tr>
<td class="left">fr</td>
<td class="left">Projectile find file</td>
</tr>


<tr>
<td class="left">rg</td>
<td class="left">Projectile grep</td>
</tr>


<tr>
<td class="left">ok</td>
<td class="left">Projectile multiple occur</td>
</tr>


<tr>
<td class="left">aw</td>
<td class="left">Projectile ack</td>
</tr>


<tr>
<td class="left">vr</td>
<td class="left">Visual regexp/replace</td>
</tr>


<tr>
<td class="left">C-x a s</td>
<td class="left">Toggle auto saving of buffers</td>
</tr>
</tbody>
</table>

## Contributions

I'm using **org-mode** to manage **steckemacs**. `.emacs` loads `steckemacs.org`, exports all the code blocks to `steckemacs.el` and loads that file to initialize **emacs**. `steckemacs.org` also contains this documentation which is used to generate `README.md` by calling:

    ;;Press C-c C-c inside this block to generate a new README.org
    (org-export-to-file 'md "README.md")

You can find more information about **Literate Programming** and **org-mode** here: <http://orgmode.org/worg/org-contrib/babel/intro.html#literate-programming>

If you want to help me out improving the config, fork the repo, create a new branch and open up a Pull Request so we can discuss the merge.

Of course you can also just [report issues](https://github.com/steckerhalter/steckemacs/issues) :)

# Code

## Load Path

The variable `load-path` lists all the directories where Emacs should look for Elisp files. The first file found is used, therefore the order of the directories is relevant.

`load-path` is documented in the [Emacs Online Manual](http://www.gnu.org/software/emacs/manual/html_node/emacs/Lisp-Libraries.html), in chapter **Libraries of Lisp Code for Emacs**. Useful tips are also on [EmacsWiki](http://www.emacswiki.org/emacs/LoadPath).

    (let ((default-directory "~/.emacs.d/elisp/"))
      (unless (file-exists-p default-directory)
        (make-directory default-directory))
      (setq load-path
            (append
             (let ((load-path (copy-sequence load-path))) ;; Shadow
               (append
                (copy-sequence (normal-top-level-add-to-load-path '(".")))
                (normal-top-level-add-subdirs-to-load-path)))
             load-path)))

Here we create the directory `~/.emacs.d/elisp/` if it does'nt exist, add it to the `load-path` and also add all subdirectories. Doing that any `.el` or `.elc` files in these directories will be available to **emacs**.

## El-Get

![El-Get Logo](./img/el-get.png)

> El-Get is designed to simplify this process and allow access to all the various methods of obtaining packages from a single interface. Every package has a recipe that allows you to locate the original source, and that can be updated if the package is moved.

![Dimitri Fontaine](//tapoueh.org/images/dim.jpeg)

Dimitri (on the image above, 20) is the clever guy that brougth us El-Get. The code is hosted [on Github](https://github.com/dimitri/el-get).

    (add-to-list 'load-path "~/.emacs.d/el-get/el-get")
    (setq el-get-install-skip-emacswiki-recipes t) (ref:wiki)
    (unless (require 'el-get nil 'noerror)
      (with-current-buffer
          (url-retrieve-synchronously
           "https://raw.github.com/dimitri/el-get/master/el-get-install.el")
        (goto-char (point-max))
        (eval-print-last-sexp)))

This sets up the load path and fetches and evaluates the stable El-Get branch if not already loaded (as described [on Github](https://github.com/dimitri/el-get#basic-setup)). In line 2 we make sure El-Get doesn't load all the Wiki recipes as we don't use them.

    (setq el-get-sources
          '(
            (:name php-documentor
                   :type http
                   :url "https://raw.github.com/wenbinye/dot-emacs/master/site-lisp/contrib/php-documentor.el")
            (:name php-align
                   :type http
                   :url "https://raw.github.com/tetsujin/emacs-php-align/master/php-align.el")
            (:name mysql
                   :type http
                   :url "http://www.emacswiki.org/emacs/download/mysql.el")
            (:name sql-completion
                   :type http
                   :url "http://www.emacswiki.org/emacs/download/sql-completion.el")
            (:name rcirc-color
                   :type http
                   :url "http://www.emacswiki.org/emacs/download/rcirc-color.el")
            (:name ac-php-doc
                   :type http
                   :url "https://raw.github.com/steckerhalter/ac-php-doc/master/ac-php-doc.el")
            (:name eval-sexp-fu
                   :type http
                   :url "http://www.emacswiki.org/emacs/download/eval-sexp-fu.el")
            (:name magit-inotify
                   :type http
                   :url "https://raw.github.com/magit/magit/master/contrib/magit-inotify.el")
            (:name outline-magic
                   :type http
                   :url "https://raw.github.com/tj64/outline-magic/master/outline-magic.el")
            (:name ob-php
                   :type http
                   :url "https://raw.github.com/steckerhalter/ob-php/master/ob-php.el"
                   :prepare (progn
                              (add-to-list 'org-babel-load-languages '(php . t))
                              (org-babel-do-load-languages 'org-babel-load-languages org-babel-load-languages)))
            ))

These are simple El-Get recipes that will fetch single Elisp files.

    (setq my-el-get-packages
          (append
           '()
           (mapcar 'el-get-source-name el-get-sources)))
    
    (el-get 'sync my-el-get-packages) (ref:sync)

The sync function expects the package names which are extracted from `el-get-sources`. In line 6 El-Get does the magic and gets the files specified in `el-get-sources`.

## Packages

    (add-to-list 'package-archives '("marmalade" . "http://marmalade-repo.org/packages/"))
    (add-to-list 'package-archives '("melpa" . "http://melpa.milkbox.net/packages/"))

This adds two remote package repositories. The repo from the FSF is already included in Emacs 24 (see <http://elpa.gnu.org/>).

[Marmalade](http://marmalade-repo.org/) is run by Nic Ferrier who wrote the Emacs webserver [Elnode](http://elnode.org/). Some packages are slightly outdated but it's still a useful resource.

The best repository by far is [MELPA](http://melpa.milkbox.net/). It builds packages directly from upstream source code. There's a nice [Twitter Feed](https://twitter.com/melpa_emacs) showing the packages that have been updated, which is great to discover new modes.

    (setq my-packages
    
          '(ack-and-a-half
            ac-nrepl
            ac-slime
            ag
            auto-complete
            auto-save-buffers-enhanced
            back-button
            buffer-move
            creole-mode
            clojure-mode
            csv-mode
            dired+
            erc-hl-nicks
            expand-region
            fic-ext-mode
            flex-isearch
            flycheck
            geben
            gist
            git-gutter-fringe+
            google-this
            grandshell-theme
            grizzl
            haskell-mode
            hide-comnt
            highlight
            helm
            helm-descbinds
            helm-c-yasnippet
            helm-gtags
            helm-git
            helm-projectile
            highlight-symbol
            iedit
            isearch+
            jinja2-mode
            js2-mode
            json-mode
            key-chord
            magit
            markdown-mode+
            melpa-upstream-visit
            mmm-mode
            mo-git-blame
            move-text
            multi-web-mode
            multiple-cursors
            nav
            nrepl
            nrepl-eval-sexp-fu
            org
            org-reveal
            paredit
            php-eldoc
            php-mode
            popup
            pos-tip
            rainbow-mode
            robe
            restclient
            slime-js
            smart-mode-line
            smartparens
            visual-regexp
            volatile-highlights
            yaml-mode
            yari
            yasnippet)
          )

Quite a big list of packages. When Emacs starts up the first time it takes quite a while to install all of them.

    (unless (condition-case nil
                (delete-process
                 (make-network-process
                  :name "stk/check-internet"
                  :host "elpa.gnu.org"
                  :service 80))
              (error t))
      (package-refresh-contents)
      (mapcar 'package-install
              (loop for p in my-packages
                    unless (package-installed-p p) collect p)))

This part first checks if there is an internet connection. If true it refreshes the package archive cache and goes on to install all the packages that are not yet installed.

## Key Bindings

    (defvar my-keys-minor-mode-map (make-keymap) "my-keys-minor-mode keymap.")

This is a custom keymap. It is used for a minor mode that is activated at the end. This is the only way I know of to make sure no other minor modes to these override special keys. Setting a global key will not suffice.

    (key-chord-mode 1)
    (setq key-chord-two-keys-delay 0.03)

> Key-chord lets you bind commands to combination of key-strokes. Here a "key chord" means two keys pressed simultaneously, or a single key quickly pressed twice.

The source code can be found on [EmacsWiki](http://www.emacswiki.org/emacs/key-chord.el).

We need to turn the mode on here so that we can map keys further below. We lower the delay so that chords are not triggered too easily.

    (global-set-key (kbd "C-c X") (lambda () (interactive) (shell-command "pkill emacs")))
    (global-set-key (kbd "C-c s") 'shell)
    (global-set-key (kbd "C-S-l") 'package-list-packages-no-fetch)
    (global-set-key (kbd "C-c d") 'ispell-change-dictionary)
    (global-set-key (kbd "C-h C-f") 'find-function-at-point)
    (global-set-key (kbd "C-h C-v") 'find-variable-at-point)
    (global-set-key (kbd "C-c C-w") 'browse-url-at-point)
    (key-chord-define-global "cd" (lambda () (interactive) (dired (file-name-directory (or load-file-name buffer-file-name)))))
    (key-chord-define-global "sb" 'speedbar)
    (key-chord-define-global "cg" 'customize-group)
    (global-set-key (kbd "C-c m") 'menu-bar-mode)
    (global-set-key (kbd "C--") 'text-scale-decrease)
    (global-set-key (kbd "C-=") 'text-scale-increase)
    (key-chord-define-global "ln" 'linum-mode)
    (global-set-key (kbd "C-c r") 'revert-buffer)
    (global-set-key (kbd "C-x C-b") 'ido-switch-buffer)
    (global-set-key (kbd "<f6>") (lambda () (interactive) (kill-buffer (buffer-name))))
    (global-set-key (kbd "<f8>") (lambda () (interactive) (switch-to-buffer nil)))
    (key-chord-define-global "jn" (lambda () (interactive) (switch-to-buffer nil)))
    (key-chord-define-global "fv" (lambda () (interactive) (kill-buffer (buffer-name))))
    (global-set-key (kbd "<M-up>") 'buf-move-up)
    (global-set-key (kbd "<M-down>") 'buf-move-down)
    (global-set-key (kbd "<M-left>") 'buf-move-left)
    (global-set-key (kbd "<M-right>") 'buf-move-right)
    (key-chord-define-global "eb" 'eval-buffer)
    (key-chord-define-global "sv" 'save-buffer)
    (key-chord-define-global "sc" (lambda () (interactive)(switch-to-buffer "*scratch*")))
    (global-set-key (kbd "C-0") (lambda () (interactive) (select-window (previous-window))))
    (global-set-key (kbd "C-9") (lambda () (interactive) (select-window (next-window))))
    (global-set-key (kbd "<f2>") 'split-window-vertically)
    (global-set-key (kbd "<f3>") 'split-window-horizontally)
    (global-set-key (kbd "<f4>") 'delete-window)
    (global-set-key (kbd "<f5>") 'delete-other-windows)
    (global-set-key (kbd "<C-left>") 'shrink-window)
    (global-set-key (kbd "<C-right>") 'enlarge-window)
    (global-set-key (kbd "<C-up>") 'shrink-window-horizontally)
    (global-set-key (kbd "<C-down>") 'enlarge-window-horizontally)
    (key-chord-define-global "i9" 'electric-indent-mode)
    (global-set-key (kbd "M-W") 'delete-region)
    (global-set-key (kbd "C-c j") 'join-line)
    (global-set-key (kbd "C-c w") 'whitespace-cleanup)
    (global-set-key (kbd "C-c i") (lambda () (interactive) (indent-region (point-min) (point-max))))
    (key-chord-define-global "ac" 'align-current)
    (global-set-key (kbd "C-c q") 'auto-fill-mode)
    (key-chord-define-global "vg" 'vc-git-grep)
    (key-chord-define-global "fg" 'grep-find)
    (global-set-key (kbd "C-c o") 'occur)
    (global-set-key (kbd "M-6") 'find-tag-other-window)
    (global-set-key (kbd "C-c n") 'show-file-name)
    (global-set-key (kbd "<f9>") 'my/split-window)
    (global-set-key (kbd "<f7>") 'toggle-window-split)
    (global-set-key (kbd "C-c t") (lambda () (interactive) (stk/open-terminal nil)))
    (global-set-key (kbd "C-c T") (lambda () (interactive) (stk/open-terminal t)))
    (global-set-key (kbd "C-6") 'ido-autojump)
    (key-chord-define-global "ag" 'ag-project)
    (global-set-key (kbd "C-3") 'back-button-local-backward)
    (global-set-key (kbd "C-4") 'back-button-local-forward)
    (global-set-key (kbd "C-c c") 'deft)
    (global-set-key (kbd "C-c e") (lambda () (interactive) (erc-tls :server erc-server :port erc-port :nick erc-nick :full-name erc-user-full-name :password erc-password )))
    (global-set-key (kbd "C-8") 'er/expand-region)
    (global-set-key (kbd "M-8") 'er/contract-region)
    (key-chord-define-global "fc" 'flycheck-mode)
    (global-set-key (kbd "C-c f") 'flyspell-mode)
    (key-chord-define-global "gt" 'google-this)
    (key-chord-define-global "gs" 'google-search)
    (global-set-key (kbd "M-x") 'helm-M-x)
    (global-set-key (kbd "<C-f7>") 'helm-mini)
    (global-set-key (kbd "<C-S-iso-lefttab>") 'helm-for-files)
    (global-set-key (kbd "C-x f") 'helm-find-files)
    (global-set-key (kbd "M-5") 'helm-etags-select)
    (global-set-key (kbd "M-7") 'helm-show-kill-ring)
    (global-set-key (kbd "C-5") 'helm-all-mark-rings)
    (global-set-key (kbd "M-9") 'helm-occur)
    (global-set-key (kbd "M--") 'helm-resume)
    (global-set-key (kbd "C-S-h") 'helm-descbinds)
    (global-set-key (kbd "C-c h") 'helm-projectile)
    (key-chord-define-global "fw" 'helm-find-files)
    (key-chord-define-global "hg" (lambda () (interactive) (let ((current-prefix-arg t)) (helm-do-grep))))
    (key-chord-define-global "lo" 'helm-locate)
    (key-chord-define-global "34" 'helm-imenu)
    (global-set-key (kbd "M-0") 'helm-git-find-files)
    (global-set-key (kbd "<C-f8>") 'hide/show-comments-toggle)
    (global-set-key (kbd "M-2") 'highlight-symbol-occur)
    (global-set-key (kbd "M-3") (lambda () (interactive) (highlight-symbol-jump -1)))
    (global-set-key (kbd "M-4") (lambda () (interactive) (highlight-symbol-jump 1)))
    (global-set-key (kbd "C-c g") 'magit-status)
    (global-set-key (kbd "C-c l") 'magit-log)
    (key-chord-define-global "bm" 'magit-blame-mode)
    (global-set-key (kbd "<C-f10>") 'move-text-up)
    (global-set-key (kbd "<C-f9>") 'move-text-down)
    (key-chord-define-global "nm" 'mu4e)
    (global-set-key (kbd "C-S-c C-S-c") 'mc/edit-lines)
    (global-set-key (kbd "C-<") 'mc/mark-previous-like-this)
    (global-set-key (kbd "C->") 'mc/mark-next-like-this)
    (global-set-key (kbd "C-*") 'mc/mark-all-like-this)
    (global-set-key (kbd "C-c A") 'org-capture)
    (global-set-key (kbd "C-c a") (lambda () (interactive) (org-agenda nil "n")))
    (key-chord-define-global "bv" 'var_dump-die)
    (key-chord-define-global "dv" 'var_dump)
    (key-chord-define-global "fr" 'projectile-find-file)
    (key-chord-define-global "rg" 'projectile-grep)
    (key-chord-define-global "ok" 'projectile-multi-occur)
    (key-chord-define-global "aw" 'projectile-ack)
    (key-chord-define-global "vr" 'vr/replace)
    (global-set-key (kbd "C-x a s") 'auto-save-buffers-enhanced-toggle-activity)

    (define-key key-translation-map (kbd "C-t") (kbd "C-p"))
    (define-key my-keys-minor-mode-map (kbd "<C-return>") 'helm-mini)

## general options

    ;; load the secrets if available
    (when (file-readable-p "~/.secrets.el") (load "~/.secrets.el"))
    
    (set-terminal-coding-system 'utf-8)
    (set-keyboard-coding-system 'utf-8)
    (set-language-environment "UTF-8")
    (prefer-coding-system 'utf-8)
    
    (setq
     inhibit-startup-message t
     backup-directory-alist `((".*" . ,temporary-file-directory)) ;don't clutter my fs and put backups into tmp
     auto-save-file-name-transforms `((".*" ,temporary-file-directory t))
     require-final-newline t            ;auto add newline at the end of file
     column-number-mode t               ;show the column number
     default-major-mode 'text-mode      ;use text mode per default
     truncate-partial-width-windows nil ;make side by side buffers break the lines
     mouse-yank-at-point t              ;middle click with the mouse yanks at point
     history-length 250                 ;default is 30
     locale-coding-system 'utf-8        ;utf-8 is default
     confirm-nonexistent-file-or-buffer nil
     vc-follow-symlinks t
     recentf-max-saved-items 5000
     eval-expression-print-length nil
     eval-expression-print-level nil
     )
    
    (setq-default
     tab-width 4
     indent-tabs-mode nil                ;use spaces instead of tabs
     c-basic-offset 4
     c-auto-hungry-state 1
     )
    
    (global-auto-revert-mode 1)          ;auto revert buffers when changed on disk
    (show-paren-mode t)                  ;visualize()
    (iswitchb-mode t)                    ;use advanced tab switching
    (blink-cursor-mode -1)
    (tool-bar-mode -1)                   ;disable the awful toolbar
    (menu-bar-mode -1)                   ;no menu
    (scroll-bar-mode -1)
    (savehist-mode 1)                    ;save minibuffer history
    
    ;(global-hl-line-mode 0)
    
    ;(defun yes-or-no-p (&rest ignored) t)    ;turn off most confirmations
    (defalias 'yes-or-no-p 'y-or-n-p)
    
    ; http://www.masteringemacs.org/articles/2010/11/14/disabling-prompts-emacs/
    (setq kill-buffer-query-functions
      (remq 'process-kill-buffer-query-function
             kill-buffer-query-functions))
    
    (put 'dired-find-alternate-file 'disabled nil) ;don't always open new buffers in dired
    
    (custom-set-variables
     ;; custom-set-variables was added by Custom.
     ;; If you edit it by hand, you could mess it up, so be careful.
     ;; Your init file should contain only one such instance.
     ;; If there is more than one, they won't work right.
     '(ansi-color-names-vector [("black" . "#8a8888") ("#EF3460" . "#F25A7D") ("#BDEF34" . "#DCF692") ("#EFC334" . "#F6DF92") ("#34BDEF" . "#92AAF6") ("#B300FF" . "#DF92F6") ("#3DD8FF" . "#5AF2CE") ("#FFFFFF" . "#FFFFFF")])
     '(ecb-options-version "2.40")
     '(send-mail-function (quote sendmail-send-it)))
     ;; '(session-use-package t nil (session)))

### system specific settings

    (when (eq system-type 'gnu/linux)
      (autoload 'ansi-color-for-comint-mode-on "ansi-color" nil t) ;activate coloring
      (add-hook 'shell-mode-hook 'ansi-color-for-comint-mode-on)   ;for the shell
      (setq x-select-enable-clipboard t)                           ;enable copy/paste from emacs to other apps
      )

## theme, faces, frame

    (load-theme 'grandshell t)
    
    (custom-set-faces
     '(default ((t (:background "black" :foreground "#babdb6" :family "Bitstream Vera Sans Mono" :height 89)))))
    
    ;; more useful frame title, that show either a file or a
    ;; buffer name (if the buffer isn't visiting a file)
    (setq frame-title-format
          '("" invocation-name " "(:eval (if (buffer-file-name)
                                          (abbreviate-file-name (buffer-file-name))
                                        "%b"))))

## custom functions

    ;; copy filename of current buffer to kill ring
    (defun show-file-name ()
      "Show the full path file name in the minibuffer."
      (interactive)
      (message (buffer-file-name))
      (kill-new (file-truename buffer-file-name))
      )
    
    (defun my/split-window()
      "Split the window to see the most recent buffer in the other window.
    Call a second time to restore the original window configuration."
      (interactive)
      (if (eq last-command 'my/split-window)
          (progn
            (jump-to-register :my/split-window)
            (setq this-command 'my/unsplit-window))
        (window-configuration-to-register :my/split-window)
        (switch-to-buffer-other-window nil)))
    
    (defun toggle-window-split ()
      (interactive)
      (if (= (count-windows) 2)
          (let* ((this-win-buffer (window-buffer))
             (next-win-buffer (window-buffer (next-window)))
             (this-win-edges (window-edges (selected-window)))
             (next-win-edges (window-edges (next-window)))
             (this-win-2nd (not (and (<= (car this-win-edges)
                         (car next-win-edges))
                         (<= (cadr this-win-edges)
                         (cadr next-win-edges)))))
             (splitter
              (if (= (car this-win-edges)
                 (car (window-edges (next-window))))
              'split-window-horizontally
            'split-window-vertically)))
        (delete-other-windows)
        (let ((first-win (selected-window)))
          (funcall splitter)
          (if this-win-2nd (other-window 1))
          (set-window-buffer (selected-window) this-win-buffer)
          (set-window-buffer (next-window) next-win-buffer)
          (select-window first-win)
          (if this-win-2nd (other-window 1))))))
    
    (defvar stk/terminal '("gnome-terminal" . "--working-directory=" )
      "Terminal executable and after the dot the working directory option for the terminal"
      )
    
    (defun stk/open-terminal (project-root-p)
      "Open the terminal emulator either from the project root or
      from the location of the current file."
      (start-process "*stk/terminal*" nil (car stk/terminal)
       (concat (cdr stk/terminal)
               (file-truename
                (if project-root-p (projectile-project-root)
                  (file-name-directory (or dired-directory load-file-name buffer-file-name)))
        ))
       )
      )
    
    (when (executable-find "autojump")
      (defun ido-autojump (&optional query)
        "Use autojump to open a directory with dired"
        (interactive)
        (unless query (setq query (read-from-minibuffer "Autojump query? ")))
        (let ((dir
               (let ((results
                      (split-string
                       (replace-regexp-in-string
                        ".*__.__" ""
                        (replace-regexp-in-string
                         "^'\\|'\n" ""
                         (shell-command-to-string (concat "autojump --bash --completion " query))))
                       "\n" t)))
                 (if (> (length results) 1)
                     (ido-completing-read "Dired: " results nil t)
                   (car results)))
               ))
          (if dir
              (if (file-readable-p dir)
                  (dired dir)
                (message "Directory %s doesn't exist" dir))
            (message "No directory found")
            )
          ))
    
      (defun autojump-add-directory ()
        "Adds the directory of the current buffer/file to the autojump database"
        (start-process "*autojump*" nil "autojump" "--add" (file-name-directory (buffer-file-name)))
        )
      (add-hook 'find-file-hook 'autojump-add-directory)
      )

## advices

    ;; slick-copy: make copy-past a bit more intelligent
    ;; from: http://www.emacswiki.org/emacs/SlickCopy
    (defadvice kill-ring-save (before slick-copy activate compile)
      "When called interactively with no active region, copy a single
    line instead."
      (interactive
        (if mark-active (list (region-beginning) (region-end))
          (message "Copied line")
          (list (line-beginning-position)
                   (line-beginning-position 2)))))
    
    (defadvice kill-region (before slick-cut activate compile)
      "When called interactively with no active region, kill a single
    line instead."
      (interactive
        (if mark-active (list (region-beginning) (region-end))
          (list (line-beginning-position)
            (line-beginning-position 2)))))
    
    ;; auto-close shell completion buffer from http://snarfed.org/automatically_close_completions_in_emacs_shell_comint_mode
    (defun comint-close-completions ()
      "Close the comint completions buffer.
    Used in advice to various comint functions to automatically close
    the completions buffer as soon as I'm done with it. Based on
    Dmitriy Igrishin's patched version of comint.el."
      (if comint-dynamic-list-completions-config
          (progn
            (set-window-configuration comint-dynamic-list-completions-config)
            (setq comint-dynamic-list-completions-config nil))))
    (defadvice comint-send-input (after close-completions activate)
      (comint-close-completions))
    (defadvice comint-dynamic-complete-as-filename (after close-completions activate)
      (if ad-return-value (comint-close-completions)))
    (defadvice comint-dynamic-simple-complete (after close-completions activate)
      (if (member ad-return-value '('sole 'shortest 'partial))
          (comint-close-completions)))
    (defadvice comint-dynamic-list-completions (after close-completions activate)
        (comint-close-completions)
        (if (not unread-command-events)
            ;; comint's "Type space to flush" swallows space. put it back in.
            (setq unread-command-events (listify-key-sequence " "))))
    
    ;; bury *scratch* buffer instead of kill it
    (defadvice kill-buffer (around kill-buffer-around-advice activate)
      (let ((buffer-to-kill (ad-get-arg 0)))
        (if (equal buffer-to-kill "*scratch*")
            (bury-buffer)
          ad-do-it)))

## modes

### auctex-mode

    (setq TeX-PDF-mode t)
    (setq TeX-parse-self t)
    (setq TeX-auto-save t)
    (setq TeX-save-query nil)
    
    (add-hook 'doc-view-mode-hook 'auto-revert-mode)
    (add-hook 'TeX-mode-hook
              '(lambda ()
                 (define-key TeX-mode-map (kbd "<C-f8>")
                   (lambda ()
                     (interactive)
                     (TeX-command-menu "LaTeX")))
                 )
              )

### auto-complete

    (require 'auto-complete-config)
    (ac-config-default)
    (setq ac-auto-show-menu 0.5)
    (setq ac-quick-help-height 50)
    (setq ac-quick-help-delay 1)
    (setq ac-use-fuzzy t)
    (setq ac-disable-faces nil)
    (setq ac-quick-help-prefer-x nil)
    
    (require 'pos-tip)
    ;; from http://emacswiki.org/emacs/AutoComplete
    (defun stk/ac-show-help ()
      "show docs for symbol at point or at beginning of list if not on a symbol"
      (interactive)
      (let ((s (save-excursion
                 (or (symbol-at-point)
                     (progn (backward-up-list)
                            (forward-char)
                            (symbol-at-point))))))
        (let ((doc-string (ac-symbol-documentation s)))
          (if doc-string
              (if ac-quick-help-prefer-x
                  (pos-tip-show doc-string 'popup-tip-face (point) nil -1)
                (popup-tip doc-string :point (point)))
            (message "No documentation for %s" s)
            ))))
    (define-key lisp-mode-shared-map (kbd "<f1>") 'stk/ac-show-help)
    (define-key lisp-mode-shared-map (kbd "C-c C-h") 'stk/ac-show-help)

### auto-save-buffers-enhanced

    (require 'auto-save-buffers-enhanced)
    (auto-save-buffers-enhanced-include-only-checkout-path t)
    (auto-save-buffers-enhanced t)
    (setq auto-save-buffers-enhanced-interval 1.5)
    (setq auto-save-buffers-enhanced-quiet-save-p t)

### back-button

    (require 'back-button)
    (back-button-mode 1)

### conf-mode

    (add-to-list 'auto-mode-alist '("\\.tks\\'" . conf-mode))
    (add-to-list 'ac-modes 'conf-mode)

### deft

    (setq
     deft-extension "org"
     deft-directory "~/org/deft"
     deft-text-mode 'org-mode
     deft-use-filename-as-title t
     )

### dired+

    (toggle-diredp-find-file-reuse-dir 1)

### eval-sexp-fu

    (when (and (>= emacs-major-version 24) (>= emacs-minor-version 3))
      (require 'eval-sexp-fu)
      (setq eval-sexp-fu-flash-duration 0.4)
      (turn-on-eval-sexp-fu-flash-mode)
      (key-chord-define lisp-interaction-mode-map "90" 'eval-sexp-fu-eval-sexp-inner-list)
      (key-chord-define emacs-lisp-mode-map "90" 'eval-sexp-fu-eval-sexp-inner-list)
      (define-key lisp-interaction-mode-map (kbd "C-c C-c") 'eval-sexp-fu-eval-sexp-inner-list)
      (define-key lisp-interaction-mode-map (kbd "C-c C-e") 'eval-sexp-fu-eval-sexp-inner-sexp)
      (define-key emacs-lisp-mode-map (kbd "C-c C-c") 'eval-sexp-fu-eval-sexp-inner-list)
      (define-key emacs-lisp-mode-map (kbd "C-c C-e") 'eval-sexp-fu-eval-sexp-inner-sexp)
    )

### ecb

    (setq
     ecb-primary-secondary-mouse-buttons (quote mouse-1--mouse-2)
     ecb-tip-of-the-day nil
     )

### erc mode

    (add-hook 'erc-mode-hook (lambda ()
                               (erc-truncate-mode t)
                               (erc-fill-disable)
                               (set (make-local-variable 'scroll-conservatively) 1000)
                               )
              )
    (setq erc-timestamp-format "%H:%M "
          erc-fill-prefix "      "
          erc-insert-timestamp-function 'erc-insert-timestamp-left)
    (setq erc-interpret-mirc-color t)
    (setq erc-kill-buffer-on-part t)
    (setq erc-kill-queries-on-quit t)
    (setq erc-kill-server-buffer-on-quit t)
    (setq erc-server-send-ping-interval 45)
    (setq erc-server-send-ping-timeout 180)
    (setq erc-server-reconnect-timeout 60)
    (erc-track-mode t)
    (setq erc-track-exclude-types '("JOIN" "NICK" "PART" "QUIT" "MODE"
                                    "324" "329" "332" "333" "353" "477"))
    (setq erc-hide-list '("JOIN" "PART" "QUIT" "NICK"))
    
    ;; ------ template for .secrets.el
    ;; (setq erc-prompt-for-nickserv-password nil)
    ;; (setq erc-server "hostname"
    ;;       erc-port 7000
    ;;       erc-nick "user"
    ;;       erc-user-full-name "user"
    ;;       erc-email-userid "user"
    ;;       erc-password "user:pw"
    ;;       )

### fic-ext-mode

    (add-hook 'prog-mode-hook 'fic-ext-mode) ;; highlight TODO/FIXME/...

### flex-isearch

    (setq flex-isearch-auto 'on-failed)
    (flex-isearch-mode 1)

### flycheck-mode

    (add-hook 'php-mode-hook 'flycheck-mode)
    (add-hook 'sh-mode-hook 'flycheck-mode)
    (add-hook 'json-mode-hook 'flycheck-mode)
    (add-hook 'nxml-mode-hook 'flycheck-mode)

### fringe

    (setq indicate-buffer-boundaries 'left)

### git-gutter-fringe+

    (global-git-gutter+-mode)

### google-this

    (google-this-mode 1)

### haskell-mode

    (require 'haskell-mode)
    (setq haskell-indent-thenelse 3)
    (add-hook 'haskell-mode-hook 'turn-on-haskell-doc-mode)
    (add-hook 'haskell-mode-hook 'turn-on-haskell-indent)

### helm

    (require 'helm-config)
    (setq enable-recursive-minibuffers t)
    (helm-mode 1)
    (helm-gtags-mode 1)
    (setq helm-idle-delay 0.1)
    (setq helm-input-idle-delay 0.1)
    (setq helm-buffer-max-length 50)
    (require 'helm-git)

### highlight-symbol

    (setq highlight-symbol-on-navigation-p t)
    (setq highlight-symbol-idle-delay 0.2)
    (add-hook 'prog-mode-hook 'highlight-symbol-mode)

### html-mode

    (add-to-list 'ac-modes 'html-mode)

### ido-mode

    (setq ido-enable-flex-matching t
          ido-auto-merge-work-directories-length -1
          ido-create-new-buffer 'always
          ido-everywhere t
          ido-default-buffer-method 'selected-window
          ido-max-prospects 32
          )
    (ido-mode 1)

### iedit

    (require 'iedit)
    (setq iedit-unmatched-lines-invisible-default t)

### isearch+

    (eval-after-load "isearch" '(require 'isearch+))

### jinja2-mode for twig

    (require 'jinja2-mode)
    (add-to-list 'auto-mode-alist '("\\.twig$" . jinja2-mode))

### js2-mode

    (add-to-list 'auto-mode-alist '("\\.js$" . js2-mode))
    (add-hook 'js2-mode-hook
              (lambda ()
                (when (fboundp 'slime-js-minor-mode) (slime-js-minor-mode 1))
                (local-set-key (kbd "C-c C-v") 'slime-eval-region)
                (local-set-key (kbd "C-c b") 'slime-eval-buffer)
                (local-set-key (kbd "C-x C-e") (lambda () (interactive) (slime-eval-region (line-beginning-position) (line-end-position))))
                (local-set-key (kbd "C-c h") (lambda () (interactive) (mark-paragraph) (slime-eval-region (region-beginning) (region-end))))
                ))

### json-mode

    (add-to-list 'auto-mode-alist '("\\.json\\'" . json-mode))

### magit

    (setq magit-commit-all-when-nothing-staged t)
    (add-hook 'magit-status-mode-hook 'magit-inotify-mode)

### markdown

    (add-to-list 'auto-mode-alist '("\\.markdown\\'" . markdown-mode))
    (add-to-list 'auto-mode-alist '("\\.md\\'" . markdown-mode))

### melpa-upstream-visit

    (require 'melpa-upstream-visit)

### move-text

    (require 'move-text)

### mu4e

    (when (file-exists-p "/usr/local/share/emacs/site-lisp/mu4e")
      (add-to-list 'load-path "/usr/local/share/emacs/site-lisp/mu4e")
      (autoload 'mu4e "mu4e" "Mail client based on mu (maildir-utils)." t)
      (require 'org-mu4e)
      ;; enable inline images
      (setq mu4e-view-show-images t)
      ;; use imagemagick, if available
      (when (fboundp 'imagemagick-register-types)
        (imagemagick-register-types))
      (setq mu4e-html2text-command "html2text -utf8 -width 72")
      (setq mu4e-update-interval 60)
      (setq mu4e-auto-retrieve-keys t)
      (setq mu4e-headers-leave-behavior 'apply)
      (setq mu4e-headers-visible-lines 20)
    
      (add-hook 'mu4e-headers-mode-hook (lambda () (local-set-key (kbd "X") (lambda () (interactive) (mu4e-mark-execute-all t)))))
      (add-hook 'mu4e-view-mode-hook (lambda () (local-set-key (kbd "X") (lambda () (interactive) (mu4e-mark-execute-all t)))))
    
      (defun mu4e-headers-mark-all-unread-read ()
        (interactive)
        (mu4e~headers-mark-for-each-if
         (cons 'read nil)
         (lambda (msg param)
           (memq 'unread (mu4e-msg-field msg :flags)))))
    
      (defun mu4e-flag-all-read ()
        (interactive)
        (mu4e-headers-mark-all-unread-read)
        (mu4e-mark-execute-all t))
    
      (setq message-kill-buffer-on-exit t)
    
      )

### mutt, load mail-mode

    (add-to-list 'auto-mode-alist '("/mutt" . mail-mode))
    (add-hook 'mail-mode-hook (lambda ()
                                (flyspell-mode 1)
                                ))

### nrepl

    (add-hook 'nrepl-interaction-mode-hook 'nrepl-turn-on-eldoc-mode)
    (setq nrepl-popup-stacktraces nil)
    (setq nrepl-popup-stacktraces-in-repl nil)
    (setq nrepl-hide-special-buffers t)
    
    ;; font-locking for the nrepl
    ;; https://github.com/kylefeng/.emacs.d/commit/45f2bece4652f4345ec08e68e8ef0608b81c5db7
    (add-hook 'nrepl-mode-hook
              (lambda ()
                (font-lock-mode nil)
                (clojure-mode-font-lock-setup)
                (font-lock-mode t)))
    
    (require 'ac-nrepl)
    (add-hook 'nrepl-mode-hook 'ac-nrepl-setup)
    (add-hook 'nrepl-interaction-mode-hook 'ac-nrepl-setup)
    (add-to-list 'ac-modes 'nrepl-mode)
    (define-key nrepl-interaction-mode-map (kbd "C-c C-d") 'ac-nrepl-popup-doc)

### nrepl-eval-sexp-fu

    (require 'nrepl-eval-sexp-fu)
    (setq nrepl-eval-sexp-fu-flash-duration 0.4)

### org-mode

    (require 'org)
    (require 'ox-org)
    (require 'ox-md)
    (let ((todo "~/org/todo.org"))
      (when (file-readable-p todo)
        (setq org-agenda-files '("~/org/todo.org" "~/org/deft/"))
        (setq initial-buffer-choice (lambda ()
                                      (org-agenda nil "n")
                                      (delete-other-windows)
                                      (current-buffer)
                                      ))
        ))
    (add-to-list 'auto-mode-alist '("\\.org\\'" . org-mode))
    (setq org-startup-folded 'nofold)
    (setq org-startup-indented t)
    (setq org-startup-with-inline-images t)
    (setq org-refile-targets '((org-agenda-files :maxlevel . 3)))
    (setq org-src-fontify-natively t)
    (setq org-src-tab-acts-natively t)
    (setq org-confirm-babel-evaluate nil)
    (setq org-use-speed-commands t)
    (setq org-default-notes-file (concat org-directory "/todo.org"))
    
    (setq org-capture-templates
          '(
            ("t" "Task" entry (file+headline "" "Tasks") "* TODO %?\n  %u\n  %a")
            ("s" "Simple Task" entry (file+headline "" "Tasks") "* TODO %?\n  %U\n")
            ))
    
    (add-to-list 'org-structure-template-alist '("m" "#+BEGIN_SRC emacs-lisp\n?\n#+END_SRC\n"))
    
    ;; minted
    (require 'ox-latex)
    (add-to-list 'org-latex-packages-alist '("" "minted"))
    (setq org-latex-listings 'minted)
    
    (setq org-latex-pdf-process
          '("pdflatex -shell-escape -interaction nonstopmode -output-directory %o %f"
            "pdflatex -shell-escape -interaction nonstopmode -output-directory %o %f"
            "pdflatex -shell-escape -interaction nonstopmode -output-directory %o %f"))
    
    (setq
     appt-display-mode-line t     ; show in the modeline
     appt-display-format 'window)
    (appt-activate 1)              ; activate appt (appointment notification)
    
    (org-agenda-to-appt)           ; add appointments on startup
    
    ;; add new appointments when saving the org buffer, use 'refresh argument to do it properly
    (add-hook 'org-mode-hook
              (lambda ()
                (add-hook 'after-save-hook '(lambda () (org-agenda-to-appt 'refresh)) nil 'make-it-local)
                (local-set-key "\C-cd" 'org-toodledo-mark-task-deleted)
                (local-set-key "\C-cs" 'org-toodledo-sync)
                ))
    (setq appt-disp-window-function '(lambda (min-to-app new-time msg) (interactive)
                                       (shell-command (concat "notify-send -i /usr/share/icons/gnome/32x32/status/appointment-soon.png '" (format "Appointment in %s min" min-to-app) "' '" msg "'")))
          )
    ;; add state to the sorting strategy of todo
    (setcdr (assq 'todo org-agenda-sorting-strategy) '(todo-state-up priority-down category-keep))
    ;; define todo states: set time stamps one waiting, delegated and done
    (setq org-todo-keywords
          '((sequence
             "TODO(t)"
             "REMINDER(r)"
             "WAITING(w!)"
             "DELEGATED(g!)"
             "SOMEDAY(s)"
             "|"
             "DONE(d!)"
             )))

### org-reveal

    (load "org-reveal")
    (define-key org-mode-map (kbd "C-c C-v") 'org-reveal-export-to-html)

### php-mode

    (require 'php-mode)
    (add-to-list 'auto-mode-alist '("\\.module\\'" . php-mode))
    (setq php-mode-coding-style "Symfony2")
    (setq php-template-compatibility nil)
    
    (let ((manual "/usr/share/doc/php-doc/html/"))
      (when (file-readable-p manual)
        (setq php-manual-path manual)))
    
    (defun setup-php-mode ()
      (require 'php-documentor nil t)
      (local-set-key (kbd "C-c p") 'php-documentor-dwim)
      (require 'php-align nil t)
      (php-align-setup)
      (php-eldoc-enable)
      (set-up-php-ac)
      )
    
    (add-hook 'php-mode-hook 'setup-php-mode)
    
    ;; die me some var_dump quickly
    (defun var_dump-die ()
      (interactive)
      (let ((expression (if (region-active-p)
                            (buffer-substring (region-beginning) (region-end))
                          (sexp-at-point)))
            (line (thing-at-point 'line))
            (pre "die(var_dump(")
            (post "));")
            )
        (if expression
            (progn
              (beginning-of-line)
              (if (string-match "return" line)
                  (progn
                    (newline)
                    (previous-line))
                (next-line)
                (newline)
                (previous-line)
                )
              (insert pre)
              (insert (format "%s" expression))
              (insert post))
          ()
          (insert pre)
          (insert post)
          (backward-char (length post))
          )))
    
    (defun var_dump ()
      (interactive)
      (if (region-active-p)
        (progn
          (goto-char (region-end))
          (insert ");")
          (goto-char (region-beginning))
          (insert "var_dump("))
        (insert "var_dump();")
        (backward-char 3)
        ))

### prog-mode

    (add-hook 'prog-mode-hook (lambda () (interactive) (setq show-trailing-whitespace 1))) ; show whitespace errors

### projectile

    (require 'projectile nil t)
    (setq projectile-completion-system 'grizzl)

### rainbow-mode

    (dolist (hook '(css-mode-hook
                    html-mode-hook
                    js-mode-hook
                    emacs-lisp-mode-hook
                    org-mode-hook
                    text-mode-hook
                    ))
      (add-hook hook 'rainbow-mode)
      )

### rcirc

    (eval-after-load 'rcirc '(require 'rcirc-color))
    (setq rcirc-fill-column 'frame-width)
    (add-hook 'rcirc-mode-hook
              (lambda ()
                (flyspell-mode 1)
                (rcirc-omit-mode)
                (set (make-local-variable 'scroll-conservatively) 8192)))

### robe

    (add-hook 'ruby-mode-hook
              (lambda ()
                (robe-mode 1)
                (push 'ac-source-robe ac-sources)))

### saveplace

    (require 'saveplace)
    (setq-default save-place t)

### slime-js

    (dolist (hook '(css-mode-hook
                    html-mode-hook
                    js-mode-hook))
      (add-hook hook (lambda ()
                       (when (fboundp 'slime-js-minor-mode)
                         (add-hook 'after-save-hook 'slime-js-reload nil 'make-it-local))
                       )
                ))
    
    ;; smart-mode-line
    (setq sml/show-encoding t)
    (setq sml/vc-mode-show-backend t)
    (setq sml/override-theme nil)
    (sml/setup)
    (set-face-attribute 'sml/prefix nil :foreground "#dcf692")
    (set-face-attribute 'sml/folder nil :foreground "#f09fff")
    (set-face-attribute 'sml/filename nil :foreground "#f6df92")
    (set-face-attribute 'sml/vc-edited nil :foreground "#ff5f87")

### smartparens

    (require 'smartparens-config)
    (smartparens-global-mode t)
    (define-key sp-keymap (kbd "M-o") 'sp-backward-sexp)
    (define-key sp-keymap (kbd "M-i") 'sp-forward-sexp)
    (define-key sp-keymap (kbd "C-{") 'sp-select-previous-thing)
    (define-key sp-keymap (kbd "C-}") 'sp-select-next-thing)
    (define-key sp-keymap (kbd "C-\\") 'sp-select-previous-thing-exchange)
    (define-key sp-keymap (kbd "C-]") 'sp-select-next-thing-exchange)
    ;; "fix"" highlight issue in scratch buffer
    (custom-set-faces '(sp-pair-overlay-face ((t ()))))

### sgml

    (setq sgml-basic-offset 4)
    (add-hook 'sgml-mode-hook 'sgml-electric-tag-pair-mode)

### slime

    (when (file-exists-p "~/quicklisp/slime-helper.el") (load "~/quicklisp/slime-helper.el"))
    (add-hook 'slime-mode-hook 'set-up-slime-ac)
    (add-hook 'slime-repl-mode-hook 'set-up-slime-ac)
    (eval-after-load "auto-complete"
      '(add-to-list 'ac-modes 'slime-repl-mode))

### sql-completion

    (when (require 'sql-completion nil t)
      (setq sql-interactive-mode-hook
            (lambda ()
              (define-key sql-interactive-mode-map "\t" 'comint-dynamic-complete)
              (sql-mysql-completion-init)))
      )

### term-mode

    (add-hook 'term-mode-hook (lambda()
                    (yas-minor-mode -1)))

### tempo

    (require 'tempo nil t)

### uniqify

    (require 'uniquify)
    (setq uniquify-buffer-name-style 'forward)
    (setq uniquify-min-dir-content 2)

### yaml-mode

    (setq yaml-indent-offset 4)

### yasnippets

    (yas-global-mode 1)
    (setq yas-prompt-functions '(yas-completing-prompt yas-ido-prompt yas-x-prompt yas-dropdown-prompt yas-no-prompt))

### w3m, optional

    (when (require 'w3m nil t)
      (setq
       w3m-use-favicon nil
       w3m-default-display-inline-images t
       w3m-search-word-at-point nil
       w3m-use-cookies t
       w3m-home-page "http://en.wikipedia.org/"
       w3m-cookie-accept-bad-cookies t
       w3m-session-crash-recovery nil)
      (add-hook 'w3m-mode-hook
                (function (lambda ()
                            (set-face-foreground 'w3m-anchor-face "LightSalmon")
                            (set-face-foreground 'w3m-arrived-anchor-face "LightGoldenrod")
                            ;;(set-face-background 'w3m-image-anchor "black")
                            (load "w3m-lnum")
                            (defun w3m-go-to-linknum ()
                              "Turn on link numbers and ask for one to go to."
                              (interactive)
                              (let ((active w3m-lnum-mode))
                                (when (not active) (w3m-lnum-mode))
                                (unwind-protect
                                    (w3m-move-numbered-anchor (read-number "Anchor number: "))
                                  (when (not active) (w3m-lnum-mode))))
                              (w3m-view-this-url)
                              )
                            (define-key w3m-mode-map "f" 'w3m-go-to-linknum)
                            (define-key w3m-mode-map "L" 'w3m-lnum-mode)
                            (define-key w3m-mode-map "o" 'w3m-previous-anchor)
                            (define-key w3m-mode-map "i" 'w3m-next-anchor)
                            (define-key w3m-mode-map "w" 'w3m-search-new-session)
                            (define-key w3m-mode-map "p" 'w3m-previous-buffer)
                            (define-key w3m-mode-map "n" 'w3m-next-buffer)
                            (define-key w3m-mode-map "z" 'w3m-delete-buffer)
                            (define-key w3m-mode-map "O" 'w3m-goto-new-session-url)
                            )))
      )

### yaml-mode

    (setq yaml-indent-offset 4)

## end

### my-keys-minor-mode

    (define-minor-mode my-keys-minor-mode
      "A minor mode so that my key settings override annoying major modes."
      t " K" 'my-keys-minor-mode-map)
    (my-keys-minor-mode 1)
